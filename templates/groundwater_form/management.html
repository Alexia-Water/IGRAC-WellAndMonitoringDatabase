{% load gwml2_forms %}
<div id="management" class="tab-pane">
    <div class="section">
        <table>
            <tr>
                <td><h4>Organisation</h4></td>
            </tr>
            {% field_as_row organisation.management_type %}
            {% field_as_row organisation.organisation %}
            {% field_as_row organisation.owner %}
            {% field_as_row organisation.responsible %}
            {% field_as_row organisation.description %}
            <tr>
                <td><h4>Production</h4></td>
            </tr>
            {% field_as_row form.groundwater_use %}
            {% field_as_row form.number_of_people_served %}
            </tr>
            <tr>
                <td><h4>License</h4></td>
            </tr>
            {% field_as_row license.id %}
            {% field_as_row license.validity_from %}
            {% field_as_row license.validity_to %}
            {% field_as_row license.description %}
        </table>
    </div>
</div>

<script>
    $('#management #id_validity_from').datepicker({
        format: 'DD-MM-YYYY',
    });
    $('#management #id_validity_to').datepicker({
        format: 'DD-MM-YYYY',
    });
    submitFunctions['management'] = function () {
        let data = {
            organisation: {},
            license: {}
        }
        {% for field in form %}
            data['{{ field.name }}'] = $('#management #{{ field.id_for_label }}').val()
        {% endfor %}
        {% for field in organisation %}
            data['organisation']['{{ field.name }}'] = $('#management #{{ field.id_for_label }}').val()
        {% endfor %}
        {% for field in license %}
            data['license']['{{ field.name }}'] = $('#management #{{ field.id_for_label }}').val()
        {% endfor %}
        return data
    }
</script>